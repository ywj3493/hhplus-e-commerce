# Coupon Domain - Use Cases

**문서 정보**
- **버전**: 2.0.0
- **최종 수정일**: 2025-11-03
- **상태**: Active
- **작성자**: Development Team
- **대상 독자**: Product Managers, Business Analysts, QA

---

**문서 네비게이션**
- ⬆️ 상위: [Dashboard 개요](../README.md)
- ⬅️ 이전: [Payment 유스케이스](../payment/use-cases.md)
- ➡️ 다음: [Coupon 시퀀스 다이어그램](./sequence-diagrams.md)
- 🔗 기술 문서: [Coupon 시퀀스 다이어그램](./sequence-diagrams.md)

---

## 목차
1. [개요](#1-개요)
2. [유스케이스 목록](#2-유스케이스-목록)
3. [UC-COUPON-01: 쿠폰 발급](#3-uc-coupon-01-쿠폰-발급)
4. [UC-COUPON-02: 사용자 쿠폰 조회](#4-uc-coupon-02-사용자-쿠폰-조회)
5. [UC-COUPON-03: 쿠폰 사용](#5-uc-coupon-03-쿠폰-사용)

---

## 1. 개요

### 1.1 도메인 설명
Coupon 도메인은 할인 쿠폰의 발급, 조회, 사용을 관리합니다. 선착순 쿠폰 발급과 사용자당 1회 제한 정책을 적용합니다.

### 1.2 주요 책임
- 쿠폰 발급 (선착순)
- 사용자별 쿠폰 조회
- 쿠폰 검증 및 사용 처리
- 중복 발급 방지
- 쿠폰 수량 관리

### 1.3 쿠폰 정책
- **발급 방식**: 선착순 (First-Come-First-Served)
- **사용 제한**: 사용자당 1회
- **중복 발급**: 불가
- **쿠폰 타입**: 정률(%) 또는 정액(원) 할인

### 1.4 관련 문서
- [요구사항: FR-COUPON-01 ~ FR-COUPON-03](../requirements.md)
- [사용자 스토리: US-COUPON-01 ~ US-COUPON-04](../user-stories.md)
- [API 명세: Coupon APIs](../api-specification.md)
- [데이터 모델: Coupon Domain](../data-model.md)
- [기술 명세: Coupon 시퀀스 다이어그램](./sequence-diagrams.md)

---

## 2. 유스케이스 목록

| ID | 유스케이스 명 | Actor | User Story | API Endpoint | 우선순위 |
|----|---------------|-------|------------|--------------|----------|
| UC-COUPON-01 | 쿠폰 발급 | Customer | US-COUPON-01 | POST /coupons/:id/issue | MUST |
| UC-COUPON-02 | 사용자 쿠폰 조회 | Customer | US-COUPON-02 | GET /users/coupons | MUST |
| UC-COUPON-03 | 쿠폰 사용 (주문 시) | System | US-COUPON-03 | (Internal) | MUST |

---

## 3. UC-COUPON-01: 쿠폰 발급

### 3.1 기본 정보

| 항목 | 내용 |
|------|------|
| **Use Case ID** | UC-COUPON-01 |
| **Use Case 명** | 쿠폰 발급 (선착순, 1인 1회) |
| **Actor** | Customer |
| **Goal** | 고객이 할인 쿠폰을 발급받아 향후 주문 시 사용한다 |
| **관련 User Story** | US-COUPON-01 |
| **관련 요구사항** | FR-COUPON-01 |
| **API Endpoint** | POST /coupons/:id/issue |
| **우선순위** | MUST |

### 3.2 유스케이스 설명
고객이 특정 쿠폰을 발급받습니다. 수량 제한이 있으며 선착순으로 발급됩니다. 이미 발급받은 쿠폰은 재발급 불가합니다.

### 3.3 사전 조건 (Pre-conditions)
- 고객이 로그인되어 있어야 함
- 발급받으려는 쿠폰이 시스템에 등록되어 있어야 함
- 쿠폰 발급 기간 내여야 함 (validFrom ≤ now ≤ validUntil)

### 3.4 주요 흐름 (Main Flow)

1. **쿠폰 선택**
   - 고객이 쿠폰 목록 또는 프로모션 페이지에서 원하는 쿠폰을 선택한다
   - 시스템은 쿠폰의 상세 정보를 표시한다:
     - 쿠폰명
     - 할인 혜택 (예: "10% 할인" 또는 "5,000원 할인")
     - 발급 가능 수량 (예: "남은 수량: 50개")
     - 유효기간

2. **쿠폰 발급 요청**
   - 고객이 "쿠폰 받기" 버튼을 클릭한다
   - 시스템은 쿠폰 발급 가능 여부를 확인한다

3. **발급 처리**
   - 시스템은 쿠폰 발급 조건을 검증한다:
     - 쿠폰이 소진되지 않았는지 확인
     - 고객이 이미 발급받지 않았는지 확인
     - 쿠폰 유효기간 내인지 확인
   - 시스템은 고객에게 쿠폰을 발급한다
   - 시스템은 발급 가능 수량을 1 감소시킨다

4. **결과 표시**
   - 시스템은 "쿠폰 발급 완료" 메시지를 표시한다
   - 시스템은 발급받은 쿠폰 정보를 표시한다:
     - 쿠폰명
     - 할인 혜택
     - 사용 가능 기간
   - 고객이 "내 쿠폰함" 으로 이동할 수 있는 링크를 제공한다

### 3.5 대체 흐름 (Alternative Flows)

**AF-1: 쿠폰이 모두 소진된 경우**
- 고객이 "쿠폰 받기" 버튼을 클릭한다
- 시스템은 "쿠폰이 모두 소진되었습니다" 메시지를 표시한다
- 시스템은 유사한 다른 쿠폰을 추천한다

**AF-2: 이미 발급받은 쿠폰인 경우**
- 고객이 "쿠폰 받기" 버튼을 클릭한다
- 시스템은 "이미 발급받은 쿠폰입니다" 메시지를 표시한다
- 시스템은 "내 쿠폰함 보기" 링크를 제공한다

**AF-3: 쿠폰 발급 기간이 아닌 경우**
- 고객이 만료되었거나 아직 시작되지 않은 쿠폰의 "쿠폰 받기" 버튼을 클릭한다
- 시스템은 "쿠폰 발급 기간이 아닙니다" 메시지를 표시한다
- 시스템은 쿠폰 발급 가능 기간을 안내한다

### 3.6 사후 조건 (Post-conditions)
- 고객의 쿠폰함에 새로운 쿠폰이 추가된다
- 쿠폰의 발급 가능 수량이 1 감소한다
- 고객이 주문 시 해당 쿠폰을 사용할 수 있게 된다

### 3.7 비즈니스 규칙 (Business Rules)

| ID | 규칙 | 설명 |
|----|------|------|
| BR-COUPON-01 | 1인 1회 발급 제한 | 동일 고객은 동일 쿠폰을 1번만 발급받을 수 있음 |
| BR-COUPON-02 | 선착순 발급 | 쿠폰 수량이 소진되면 발급 불가 |
| BR-COUPON-03 | 유효기간 검증 | 쿠폰 발급 기간(validFrom ~ validUntil) 내에만 발급 가능 |
| BR-COUPON-04 | 동시 발급 방지 | 동일 쿠폰에 대한 동시 발급 요청 시 1건만 성공 |

### 3.8 예외 케이스 (Exception Cases)

| 예외 상황 | 시스템 동작 |
|-----------|-------------|
| 존재하지 않는 쿠폰 | "쿠폰을 찾을 수 없습니다" 에러 메시지 표시 |
| 이미 발급받은 쿠폰 | "이미 발급받은 쿠폰입니다" 메시지 표시, 쿠폰함 링크 제공 |
| 쿠폰 소진 | "쿠폰이 모두 소진되었습니다" 메시지 표시, 유사 쿠폰 추천 |
| 쿠폰 기간 만료 | "쿠폰 발급 기간이 아닙니다" 메시지 표시, 발급 가능 기간 안내 |
| 로그인하지 않은 상태 | 로그인 페이지로 리다이렉트 |

---

## 4. UC-COUPON-02: 사용자 쿠폰 조회

### 4.1 기본 정보

| 항목 | 내용 |
|------|------|
| **Use Case ID** | UC-COUPON-02 |
| **Use Case 명** | 사용자 쿠폰 조회 (사용 가능한 쿠폰 목록) |
| **Actor** | Customer |
| **Goal** | 고객이 보유한 쿠폰을 확인하고 사용 가능한 쿠폰을 파악한다 |
| **관련 User Story** | US-COUPON-02 |
| **관련 요구사항** | FR-COUPON-02 |
| **API Endpoint** | GET /users/coupons |
| **우선순위** | MUST |

### 4.2 유스케이스 설명
로그인한 고객이 보유한 쿠폰 목록을 조회합니다. 사용 가능한 쿠폰과 사용 완료된 쿠폰을 구분하여 표시합니다.

### 4.3 사전 조건 (Pre-conditions)
- 고객이 로그인되어 있어야 함

### 4.4 주요 흐름 (Main Flow)

1. **쿠폰함 접근**
   - 고객이 마이페이지에서 "내 쿠폰함" 메뉴를 선택한다
   - 시스템은 쿠폰함 페이지로 이동한다

2. **쿠폰 목록 조회**
   - 시스템은 고객이 발급받은 모든 쿠폰을 조회한다
   - 시스템은 쿠폰을 사용 가능 여부에 따라 분류한다

3. **사용 가능 쿠폰 표시**
   - 시스템은 사용 가능한 쿠폰 목록을 표시한다:
     - 쿠폰명
     - 할인 혜택
     - 사용 가능 기간
     - "사용 가능" 뱃지
   - 최신 발급순으로 정렬하여 표시한다

4. **사용 완료 쿠폰 표시**
   - 시스템은 사용 완료된 쿠폰 목록을 별도 탭으로 표시한다:
     - 쿠폰명
     - 할인 혜택
     - 사용일
     - "사용 완료" 뱃지
   - 사용일 최신순으로 정렬하여 표시한다

### 4.5 대체 흐름 (Alternative Flows)

**AF-1: 보유한 쿠폰이 없는 경우**
- 시스템은 "보유한 쿠폰이 없습니다" 메시지를 표시한다
- 시스템은 "쿠폰 받으러 가기" 버튼을 제공한다

**AF-2: 사용 가능한 쿠폰이 없는 경우**
- 시스템은 "현재 사용 가능한 쿠폰이 없습니다" 메시지를 표시한다
- 시스템은 사용 완료된 쿠폰 목록은 표시한다
- 시스템은 "새 쿠폰 받기" 버튼을 제공한다

### 4.6 사후 조건 (Post-conditions)
- 고객이 보유한 모든 쿠폰의 상태를 확인한다
- 고객이 사용 가능한 쿠폰을 파악하여 주문 시 활용할 수 있다

### 4.7 비즈니스 규칙 (Business Rules)

| ID | 규칙 | 설명 |
|----|------|------|
| BR-COUPON-05 | 사용 가능 분류 | isUsed = false AND 쿠폰 유효기간 내인 경우만 "사용 가능" |
| BR-COUPON-06 | 사용 완료 분류 | isUsed = true인 경우 "사용 완료" |
| BR-COUPON-07 | 정렬 순서 | 사용 가능 쿠폰은 발급일 최신순, 사용 완료 쿠폰은 사용일 최신순 |

### 4.8 예외 케이스 (Exception Cases)

| 예외 상황 | 시스템 동작 |
|-----------|-------------|
| 쿠폰 없음 | 빈 목록 표시, "쿠폰 받으러 가기" 버튼 제공 |
| 로그인하지 않은 상태 | 로그인 페이지로 리다이렉트 |

---

## 5. UC-COUPON-03: 쿠폰 사용

### 5.1 기본 정보

| 항목 | 내용 |
|------|------|
| **Use Case ID** | UC-COUPON-03 |
| **Use Case 명** | 쿠폰 사용 (주문 생성 시) |
| **Actor** | System (Internal) |
| **Goal** | 주문 생성 시 쿠폰을 적용하여 할인 혜택을 제공한다 |
| **관련 User Story** | US-COUPON-03 |
| **관련 요구사항** | FR-COUPON-03 |
| **API Endpoint** | N/A (주문 생성 UseCase 내부) |
| **우선순위** | MUST |

### 5.2 유스케이스 설명
주문 생성 시 쿠폰을 적용하고 사용 처리합니다. 쿠폰 유효성을 검증하고, 할인 금액을 계산합니다.

### 5.3 사전 조건 (Pre-conditions)
- 고객이 주문 생성 프로세스를 진행 중이어야 함
- 적용하려는 쿠폰이 고객에게 발급되어 있어야 함
- 쿠폰이 아직 사용되지 않았어야 함

### 5.4 주요 흐름 (Main Flow)

1. **쿠폰 선택**
   - 고객이 주문 페이지에서 "쿠폰 선택" 버튼을 클릭한다
   - 시스템은 사용 가능한 쿠폰 목록을 표시한다
   - 고객이 사용할 쿠폰을 선택한다

2. **쿠폰 검증**
   - 시스템은 선택한 쿠폰의 유효성을 확인한다:
     - 쿠폰이 아직 사용되지 않았는지 확인
     - 쿠폰이 유효기간 내인지 확인
     - 쿠폰이 고객에게 발급된 것이 맞는지 확인

3. **할인 계산**
   - 시스템은 쿠폰 타입에 따라 할인 금액을 계산한다:
     - **정률(%)**: 주문 금액 × (할인율 / 100)
     - **정액(원)**: 할인 금액 (단, 주문 금액 초과 불가)
   - 시스템은 할인 적용 후 최종 결제 금액을 계산한다

4. **쿠폰 사용 처리**
   - 주문이 성공적으로 생성되면 시스템은 쿠폰을 사용 처리한다
   - 쿠폰의 사용 여부를 "사용됨"으로 변경한다
   - 사용 일시를 기록한다

5. **할인 내역 표시**
   - 시스템은 주문 내역에 쿠폰 할인 정보를 표시한다:
     - 사용한 쿠폰명
     - 할인 금액
     - 할인 적용 후 최종 결제 금액

### 5.5 대체 흐름 (Alternative Flows)

**AF-1: 쿠폰이 만료된 경우**
- 시스템은 쿠폰 유효기간을 확인한다
- 시스템은 "쿠폰이 만료되었습니다" 에러 메시지를 표시한다
- 주문 프로세스를 중단하고 쿠폰 선택 단계로 돌아간다

**AF-2: 쿠폰이 이미 사용된 경우**
- 시스템은 쿠폰 사용 여부를 확인한다
- 시스템은 "이미 사용된 쿠폰입니다" 에러 메시지를 표시한다
- 주문 프로세스를 중단하고 쿠폰 선택 단계로 돌아간다

**AF-3: 쿠폰 없이 주문하는 경우**
- 고객이 쿠폰을 선택하지 않고 주문을 진행한다
- 시스템은 쿠폰 할인 없이 주문을 생성한다

### 5.6 사후 조건 (Post-conditions)
- 쿠폰이 "사용됨" 상태로 변경된다
- 주문에 쿠폰 할인이 적용된다
- 고객이 할인된 금액으로 결제를 진행한다
- 쿠폰을 재사용할 수 없게 된다

### 5.7 비즈니스 규칙 (Business Rules)

| ID | 규칙 | 설명 |
|----|------|------|
| BR-COUPON-08 | 쿠폰 1회 사용 제한 | 한 번 사용된 쿠폰은 재사용 불가 |
| BR-COUPON-09 | 유효기간 내 사용 | 쿠폰 유효기간(validFrom ~ validUntil) 내에만 사용 가능 |
| BR-COUPON-10 | 정률 할인 계산 | 주문 금액 × (할인율 / 100) |
| BR-COUPON-11 | 정액 할인 계산 | min(할인 금액, 주문 금액) |
| BR-COUPON-12 | 주문 실패 시 롤백 | 주문 생성 실패 시 쿠폰 사용 처리도 롤백 |

### 5.8 예외 케이스 (Exception Cases)

| 예외 상황 | 시스템 동작 |
|-----------|-------------|
| 쿠폰 만료 | "쿠폰이 만료되었습니다" 에러 메시지, 주문 중단 |
| 이미 사용한 쿠폰 | "이미 사용된 쿠폰입니다" 에러 메시지, 주문 중단 |
| 존재하지 않는 쿠폰 | "쿠폰을 찾을 수 없습니다" 에러 메시지, 주문 중단 |
| 타인의 쿠폰 사용 시도 | "사용 권한이 없는 쿠폰입니다" 에러 메시지, 주문 중단 |

### 5.9 관련 유스케이스
- [UC-ORDER-01: 주문 생성](../order/use-cases.md) - 쿠폰 적용과 함께 주문 생성

---

## 6. 도메인 용어 정리

| 용어 | 설명 |
|------|------|
| **쿠폰 (Coupon)** | 할인 혜택을 제공하는 프로모션 아이템 |
| **쿠폰 타입** | 정률(%) 또는 정액(원) 할인 방식 |
| **발급 (Issue)** | 고객에게 쿠폰을 제공하는 행위 |
| **사용자 쿠폰 (UserCoupon)** | 특정 고객에게 발급된 쿠폰 인스턴스 |
| **사용 가능 쿠폰** | 아직 사용하지 않았고 유효기간 내인 쿠폰 |
| **사용 완료 쿠폰** | 이미 주문에 사용된 쿠폰 |
| **선착순** | 쿠폰 수량이 소진될 때까지 발급 가능한 방식 |
| **유효기간** | 쿠폰을 발급하거나 사용할 수 있는 기간 |

---

## 7. 관련 문서

- [아키텍처](../architecture.md) - 시스템 아키텍처
- [요구사항 분석](../requirements.md) - 비즈니스 요구사항
- [사용자 스토리](../user-stories.md) - 사용자 관점의 시나리오
- [API 명세서](../api-specification.md) - REST API 계약
- [데이터 모델](../data-model.md) - 데이터베이스 스키마
- [Coupon 시퀀스 다이어그램](./sequence-diagrams.md) - 기술 구현 명세
- [Order 유스케이스](../order/use-cases.md) - 쿠폰 사용 연관 도메인

---

## 8. 버전 히스토리

| 버전 | 날짜 | 작성자 | 변경 내역 |
|------|------|--------|-----------|
| 1.0.0 | 2025-11-03 | Development Team | 초기 문서 작성 |
| 2.0.0 | 2025-11-03 | Development Team | 비즈니스 관점과 기술 관점 분리 (Issue #006) |

---

**문서 끝**
